import{b6 as C,b9 as T,bd as b,r as d,c as r,o as l,f as y,g as h,A as c,V as M,d as m,y as S,t as g,ao as v,ap as k,be as w,b7 as u,b8 as p}from"./_plugin-vue_export-helper-BemuwRpB.chunk.mjs";import{M as B,l as L}from"./logger-Dn3kbj54.chunk.mjs";const H={name:"UserApp",components:{NcModal:b,ModalContent:B},data(){return{showModal:!1,hasSigned:!1,terms:{},languages:[],selectedLanguage:0,termsId:0,termsBody:"",publicContent:null,hasScrolledToBottom:!1}},watch:{selectedLanguage(e){this.selectTerms(e)}},mounted(){this.loadTerms()},methods:{async loadTerms(){try{const e=await u.get(p("/apps/terms_of_service/terms"));this.hasSigned=e.data.ocs.data.hasSigned,this.terms=e.data.ocs.data.terms;const s=OC.getLanguage().split("-")[0];if(!this.terms.length||this.hasSigned)return;this.publicContent=document.getElementById("files-public-content"),this.publicContent!==null&&(this.publicContent.style.visibility="hidden"),this.selectTerms(0),this.terms.length>1&&Object.keys(this.terms).forEach(n=>{s===this.terms[n].languageCode&&(this.selectedLanguage=n),this.languages.push(e.data.ocs.data.languages[this.terms[n].languageCode])}),this.showTerms()}catch(e){L.error("Error loading terms:",e)}},selectTerms(e){this.termsBody=this.terms[e].renderedBody,this.termsId=this.terms[e].id},showTerms(){this.showModal=!0,this.$nextTick(()=>{this.checkScroll()})},acceptTerms(){this.hasSigned=!0,this.showModal=!1;let e="/apps/terms_of_service/sign";this.$root.source==="public"&&(e="/apps/terms_of_service/sign_public"),u.post(p(e),{termId:this.termsId}).then(()=>{window.location.reload()})},handleCloseModal(){this.showModal=!1},checkScroll(){const e=this.$refs.termsContent,s=e.scrollHeight>e.clientHeight;this.hasScrolledToBottom=!s||e.scrollHeight-e.scrollTop<=e.clientHeight+1},t:T}},I={id:"terms_of_service_confirm"},x=["value"],E=["innerHTML"];function A(e,s,n,N,t,o){const f=d("ModalContent"),_=d("NcModal");return l(),r("div",I,[t.showModal?(l(),y(_,{key:0,"no-close":!t.hasSigned,onClose:o.handleCloseModal},{default:c(()=>[M(f,{"is-scroll-complete":t.hasScrolledToBottom,onClick:o.acceptTerms},{header:c(()=>[m("h3",null,g(o.t("terms_of_service","Terms of service")),1),t.terms.length>1?S((l(),r("select",{key:0,"onUpdate:modelValue":s[0]||(s[0]=a=>t.selectedLanguage=a)},[(l(!0),r(v,null,k(t.languages,(a,i)=>(l(),r("option",{key:i,value:i},g(a),9,x))),128))],512)),[[w,t.selectedLanguage]]):h("",!0)]),default:c(()=>[m("div",{ref:"termsContent",class:"text-content",onScroll:s[1]||(s[1]=(...a)=>o.checkScroll&&o.checkScroll(...a)),innerHTML:t.termsBody},null,40,E)]),_:1},8,["is-scroll-complete","onClick"])]),_:1},8,["no-close","onClose"])):h("",!0)])}const $=C(H,[["render",A],["__scopeId","data-v-aef5ea77"]]);export{$ as U};
//# sourceMappingURL=UserApp-vLzITm54.chunk.mjs.map
