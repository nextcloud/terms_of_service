{"version":3,"file":"UserApp-vLzITm54.chunk.mjs","sources":["../src/UserApp.vue"],"sourcesContent":["<!--\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div id=\"terms_of_service_confirm\">\n\t\t<NcModal\n\t\t\tv-if=\"showModal\"\n\t\t\t:no-close=\"!hasSigned\"\n\t\t\t@close=\"handleCloseModal\">\n\t\t\t<ModalContent :is-scroll-complete=\"hasScrolledToBottom\" @click=\"acceptTerms\">\n\t\t\t\t<template #header>\n\t\t\t\t\t<h3>{{ t('terms_of_service', 'Terms of service') }}</h3>\n\t\t\t\t\t<select v-if=\"terms.length > 1\" v-model=\"selectedLanguage\">\n\t\t\t\t\t\t<option v-for=\"(language, index) in languages\" :key=\"index\" :value=\"index\">\n\t\t\t\t\t\t\t{{ language }}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t</select>\n\t\t\t\t</template>\n\n\t\t\t\t<!-- eslint-disable-next-line vue/no-v-html -->\n\t\t\t\t<div\n\t\t\t\t\tref=\"termsContent\"\n\t\t\t\t\tclass=\"text-content\"\n\t\t\t\t\t@scroll=\"checkScroll\"\n\t\t\t\t\tv-html=\"termsBody\" />\n\t\t\t</ModalContent>\n\t\t</NcModal>\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { t } from '@nextcloud/l10n'\nimport { generateOcsUrl } from '@nextcloud/router'\nimport NcModal from '@nextcloud/vue/components/NcModal'\nimport ModalContent from './components/ModalContent.vue'\nimport logger from './logger.ts'\n\nexport default {\n\tname: 'UserApp',\n\n\tcomponents: {\n\t\tNcModal,\n\t\tModalContent,\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tshowModal: false,\n\t\t\thasSigned: false,\n\t\t\tterms: {},\n\t\t\tlanguages: [],\n\t\t\tselectedLanguage: 0,\n\t\t\ttermsId: 0,\n\t\t\ttermsBody: '',\n\t\t\tpublicContent: null,\n\t\t\thasScrolledToBottom: false,\n\t\t}\n\t},\n\n\twatch: {\n\t\tselectedLanguage(newLanguage) {\n\t\t\tthis.selectTerms(newLanguage)\n\t\t},\n\t},\n\n\tmounted() {\n\t\tthis.loadTerms()\n\t},\n\n\tmethods: {\n\t\tasync loadTerms() {\n\t\t\ttry {\n\t\t\t\tconst response = await axios.get(generateOcsUrl('/apps/terms_of_service/terms'))\n\t\t\t\tthis.hasSigned = response.data.ocs.data.hasSigned\n\t\t\t\tthis.terms = response.data.ocs.data.terms\n\n\t\t\t\tconst language = OC.getLanguage().split('-')[0]\n\n\t\t\t\tif (!this.terms.length || this.hasSigned) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tthis.publicContent = document.getElementById('files-public-content')\n\t\t\t\tif (this.publicContent !== null) {\n\t\t\t\t\tthis.publicContent.style.visibility = 'hidden'\n\t\t\t\t}\n\n\t\t\t\tthis.selectTerms(0)\n\t\t\t\tif (this.terms.length > 1) {\n\t\t\t\t\tObject.keys(this.terms).forEach((index) => {\n\t\t\t\t\t\tif (language === this.terms[index].languageCode) {\n\t\t\t\t\t\t\tthis.selectedLanguage = index\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.languages.push(response.data.ocs.data.languages[this.terms[index].languageCode])\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tthis.showTerms()\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error('Error loading terms:', error)\n\t\t\t}\n\t\t},\n\n\t\tselectTerms(index) {\n\t\t\tthis.termsBody = this.terms[index].renderedBody\n\t\t\tthis.termsId = this.terms[index].id\n\t\t},\n\n\t\tshowTerms() {\n\t\t\tthis.showModal = true\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.checkScroll()\n\t\t\t})\n\t\t},\n\n\t\tacceptTerms() {\n\t\t\tthis.hasSigned = true\n\t\t\tthis.showModal = false\n\n\t\t\tlet url = '/apps/terms_of_service/sign'\n\t\t\tif (this.$root.source === 'public') {\n\t\t\t\turl = '/apps/terms_of_service/sign_public'\n\t\t\t}\n\n\t\t\taxios.post(\n\t\t\t\tgenerateOcsUrl(url),\n\t\t\t\t{ termId: this.termsId },\n\t\t\t).then(() => {\n\t\t\t\twindow.location.reload()\n\t\t\t})\n\t\t},\n\n\t\thandleCloseModal() {\n\t\t\tthis.showModal = false\n\t\t},\n\n\t\tcheckScroll() {\n\t\t\tconst termsContent = this.$refs.termsContent\n\t\t\tconst isScrollable = termsContent.scrollHeight > termsContent.clientHeight\n\n\t\t\tthis.hasScrolledToBottom = !isScrollable || (termsContent.scrollHeight - termsContent.scrollTop <= termsContent.clientHeight + 1)\n\t\t},\n\n\t\tt,\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n:deep(.modal-container) {\n\tdisplay: flex;\n\theight: 100%;\n}\n</style>\n"],"names":["_sfc_main","NcModal","ModalContent","newLanguage","response","axios","generateOcsUrl","language","index","error","logger","url","termsContent","isScrollable","t","_hoisted_1","_openBlock","_createElementBlock","$data","_createBlock","_component_NcModal","$options","_createVNode","_component_ModalContent","_createElementVNode","$event","_Fragment","_renderList","_hoisted_2","args"],"mappings":"yPAwCA,MAAKA,EAAU,CACd,KAAM,UAEN,WAAY,CACX,QAAAC,EACA,aAAAC,GAGD,MAAO,CACN,MAAO,CACN,UAAW,GACX,UAAW,GACX,MAAO,CAAA,EACP,UAAW,CAAA,EACX,iBAAkB,EAClB,QAAS,EACT,UAAW,GACX,cAAe,KACf,oBAAqB,EACtB,CACD,EAEA,MAAO,CACN,iBAAiBC,EAAa,CAC7B,KAAK,YAAYA,CAAW,CAC7B,GAGD,SAAU,CACT,KAAK,UAAS,CACf,EAEA,QAAS,CACR,MAAM,WAAY,CACjB,GAAI,CACH,MAAMC,EAAW,MAAMC,EAAM,IAAIC,EAAe,8BAA8B,CAAC,EAC/E,KAAK,UAAYF,EAAS,KAAK,IAAI,KAAK,UACxC,KAAK,MAAQA,EAAS,KAAK,IAAI,KAAK,MAEpC,MAAMG,EAAW,GAAG,YAAW,EAAG,MAAM,GAAG,EAAE,CAAC,EAE9C,GAAI,CAAC,KAAK,MAAM,QAAU,KAAK,UAC9B,OAGD,KAAK,cAAgB,SAAS,eAAe,sBAAsB,EAC/D,KAAK,gBAAkB,OAC1B,KAAK,cAAc,MAAM,WAAa,UAGvC,KAAK,YAAY,CAAC,EACd,KAAK,MAAM,OAAS,GACvB,OAAO,KAAK,KAAK,KAAK,EAAE,QAASC,GAAU,CACtCD,IAAa,KAAK,MAAMC,CAAK,EAAE,eAClC,KAAK,iBAAmBA,GAGzB,KAAK,UAAU,KAAKJ,EAAS,KAAK,IAAI,KAAK,UAAU,KAAK,MAAMI,CAAK,EAAE,YAAY,CAAC,CACrF,CAAC,EAGF,KAAK,UAAS,CACf,OAASC,EAAO,CACfC,EAAO,MAAM,uBAAwBD,CAAK,CAC3C,CACD,EAEA,YAAYD,EAAO,CAClB,KAAK,UAAY,KAAK,MAAMA,CAAK,EAAE,aACnC,KAAK,QAAU,KAAK,MAAMA,CAAK,EAAE,EAClC,EAEA,WAAY,CACX,KAAK,UAAY,GACjB,KAAK,UAAU,IAAM,CACpB,KAAK,YAAW,CACjB,CAAC,CACF,EAEA,aAAc,CACb,KAAK,UAAY,GACjB,KAAK,UAAY,GAEjB,IAAIG,EAAM,8BACN,KAAK,MAAM,SAAW,WACzBA,EAAM,sCAGPN,EAAM,KACLC,EAAeK,CAAG,EAClB,CAAE,OAAQ,KAAK,UACd,KAAK,IAAM,CACZ,OAAO,SAAS,OAAM,CACvB,CAAC,CACF,EAEA,kBAAmB,CAClB,KAAK,UAAY,EAClB,EAEA,aAAc,CACb,MAAMC,EAAe,KAAK,MAAM,aAC1BC,EAAeD,EAAa,aAAeA,EAAa,aAE9D,KAAK,oBAAsB,CAACC,GAAiBD,EAAa,aAAeA,EAAa,WAAaA,EAAa,aAAe,CAChI,IAEAE,EAEF,EA/IMC,EAAA,CAAA,GAAG,0BAA0B,+FAAlC,OAAAC,EAAA,EAAAC,EAuBM,MAvBNF,EAuBM,CArBEG,EAAA,eADPC,EAqBUC,EAAA,OAnBR,YAAWF,EAAA,UACX,QAAOG,EAAA,6BACR,IAgBe,CAhBfC,EAgBeC,EAAA,CAhBA,qBAAoBL,EAAA,oBAAsB,QAAOG,EAAA,cACpD,SACV,IAAwD,CAAxDG,EAAwD,YAAjDH,EAAA,EAAC,mBAAA,kBAAA,CAAA,EAAA,CAAA,EACMH,EAAA,MAAM,OAAM,SAA1BD,EAIS,SAAA,4CAJgCC,EAAA,iBAAgBO,MACxDT,EAAA,EAAA,EAAAC,EAESS,EAAA,KAAAC,EAF2BT,EAAA,UAAS,CAA7BX,EAAUC,SAA1BS,EAES,SAAA,CAFuC,IAAKT,EAAQ,MAAOA,KAChED,CAAQ,EAAA,EAAAqB,CAAA,qBAF4BV,EAAA,gBAAgB,yBAQ1D,IAIsB,CAJtBM,EAIsB,MAAA,CAHrB,IAAI,eACJ,MAAM,eACL,6BAAQH,EAAA,aAAAA,EAAA,YAAA,GAAAQ,CAAA,GACT,UAAQX,EAAA"}