{"version":3,"file":"terms_of_service-registration.mjs","sources":["../src/RegistrationApp.vue","../src/registration.js"],"sourcesContent":["<!--\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div id=\"terms_of_service\">\n\t\t<p v-if=\"terms.length\">\n\t\t\t<input\n\t\t\t\tid=\"terms_of_service_accepted\"\n\t\t\t\tv-model=\"hasSigned\"\n\t\t\t\t:value=\"termsId\"\n\t\t\t\ttype=\"checkbox\"\n\t\t\t\tname=\"terms_of_service_accepted\"\n\t\t\t\tclass=\"checkbox\"\n\t\t\t\t@keydown.enter.prevent.stop=\"showTerms\">\n\t\t\t<label\n\t\t\t\tfor=\"terms_of_service_accepted\"\n\t\t\t\t@click.prevent.stop=\"showTerms\"\n\t\t\t\t@keydown.enter.prevent.stop=\"showTerms\">\n\t\t\t\t{{ t('terms_of_service', 'I acknowledge that I have read and agree to the above terms of service') }} â†—\n\t\t\t</label>\n\t\t</p>\n\n\t\t<div id=\"terms_of_service_confirm\">\n\t\t\t<NcModal\n\t\t\t\tv-if=\"showModal\"\n\t\t\t\t:no-close=\"!hasSigned\"\n\t\t\t\t@close=\"handleCloseModal\">\n\t\t\t\t<ModalContent :is-scroll-complete=\"hasScrolledToBottom\" @click=\"acceptTerms\">\n\t\t\t\t\t<template #header>\n\t\t\t\t\t\t<h3>{{ t('terms_of_service', 'Terms of service') }}</h3>\n\t\t\t\t\t\t<select v-if=\"terms.length > 1\" v-model=\"selectedLanguage\">\n\t\t\t\t\t\t\t<option v-for=\"(language, index) in languages\" :key=\"index\" :value=\"index\">\n\t\t\t\t\t\t\t\t{{ language }}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<!-- eslint-disable-next-line vue/no-v-html -->\n\t\t\t\t\t<div\n\t\t\t\t\t\tref=\"termsContent\"\n\t\t\t\t\t\tclass=\"text-content\"\n\t\t\t\t\t\t@scroll=\"checkScroll\"\n\t\t\t\t\t\tv-html=\"termsBody\" />\n\t\t\t\t</ModalContent>\n\t\t\t</NcModal>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { t } from '@nextcloud/l10n'\nimport { generateOcsUrl } from '@nextcloud/router'\nimport NcModal from '@nextcloud/vue/components/NcModal'\nimport ModalContent from './components/ModalContent.vue'\nimport logger from './logger.ts'\n\n// Styles\nimport '@nextcloud/dialogs/style.css'\nexport default {\n\tname: 'RegistrationApp',\n\n\tcomponents: {\n\t\tNcModal,\n\t\tModalContent,\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tshowModal: false,\n\t\t\thasSigned: false,\n\t\t\tterms: {},\n\t\t\tlanguages: [],\n\t\t\tselectedLanguage: 0,\n\t\t\ttermsId: 0,\n\t\t\ttermsBody: '',\n\t\t\tpublicContent: null,\n\t\t\thasScrolledToBottom: false,\n\t\t}\n\t},\n\n\twatch: {\n\t\tselectedLanguage(newLanguage) {\n\t\t\tthis.selectTerms(newLanguage)\n\t\t},\n\t},\n\n\tmounted() {\n\t\tthis.loadTerms()\n\t},\n\n\tmethods: {\n\t\tasync loadTerms() {\n\t\t\ttry {\n\t\t\t\tconst response = await axios.get(generateOcsUrl('/apps/terms_of_service/terms'))\n\n\t\t\t\t// this.hasSigned = response.data.ocs.data.hasSigned\n\t\t\t\tthis.terms = response.data.ocs.data.terms\n\n\t\t\t\tconst language = OC.getLanguage().split('-')[0]\n\n\t\t\t\tif (!this.terms.length || this.hasSigned) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\t// make it Vue\n\t\t\t\tthis.publicContent = document.getElementById('files-public-content')\n\t\t\t\tif (this.publicContent !== null) {\n\t\t\t\t\tthis.publicContent.style.visibility = 'hidden'\n\t\t\t\t}\n\n\t\t\t\tthis.selectTerms(0)\n\t\t\t\tif (this.terms.length > 1) {\n\t\t\t\t\tObject.keys(this.terms).forEach((index) => {\n\t\t\t\t\t\tif (language === this.terms[index].languageCode) {\n\t\t\t\t\t\t\tthis.selectedLanguage = index\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.languages.push(response.data.ocs.data.languages[this.terms[index].languageCode])\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\t// this.showTerms()\n\t\t\t} catch (e) {\n\t\t\t\tlogger.error(e)\n\t\t\t}\n\t\t},\n\n\t\tselectTerms(index) {\n\t\t\tthis.termsBody = this.terms[index].renderedBody\n\t\t\tthis.termsId = this.terms[index].id\n\t\t},\n\n\t\tshowTerms() {\n\t\t\tif (this.hasSigned) {\n\t\t\t\tthis.hasSigned = false\n\t\t\t\treturn\n\t\t\t}\n\t\t\tthis.showModal = true\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.checkScroll()\n\t\t\t})\n\t\t},\n\n\t\tcheckScroll() {\n\t\t\tconst termsContent = this.$refs.termsContent\n\t\t\tconst isScrollable = termsContent.scrollHeight > termsContent.clientHeight\n\t\t\tthis.hasScrolledToBottom = !isScrollable || (termsContent.scrollHeight - termsContent.scrollTop <= termsContent.clientHeight + 1)\n\t\t},\n\n\t\tacceptTerms() {\n\t\t\tthis.hasSigned = true\n\t\t\tthis.showModal = false\n\t\t},\n\n\t\thandleCloseModal() {\n\t\t\tthis.showModal = false\n\t\t},\n\n\t\tt,\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\n:deep(.modal-container) {\n\tdisplay: flex;\n\theight: 100%;\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { createApp } from 'vue'\nimport App from './RegistrationApp.vue'\n\ncreateApp(App, {\n\tsource: 'public',\n}).mount('#terms_of_service')\n"],"names":["_sfc_main","NcModal","ModalContent","newLanguage","response","axios","generateOcsUrl","language","index","logger","termsContent","isScrollable","t","_hoisted_1","_hoisted_4","_openBlock","_createElementBlock","$data","_hoisted_2","_createElementVNode","$event","$options","args","_toDisplayString","_createBlock","_component_NcModal","_createVNode","_component_ModalContent","_Fragment","_renderList","_hoisted_5","createApp","App"],"mappings":"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"}